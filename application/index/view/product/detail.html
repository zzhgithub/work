<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta content="width=device-width,user-scalable=no,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"
          name="viewport"/>
    <title>产品列表</title>
    <link href="/static/css/style.css" type="text/css" rel="stylesheet"/>
</head>

<body class="light">
{include file="public/header" /}
<!--轮播-->
<div class="partner">
    <div class="partner_nei">
        <ul class="swiper-wrapper">
            {volist name="productImgs" id="img"}
            <li class="swiper-slide">
                <a href="javascript:void(0);">
                    <img src="{$img.img_path}" width="100%"/>
                </a>
            </li>
            {/volist}
        </ul>
        <!--结束切换内容-->
        <div class="live_partner">
            <div class="live_partn"></div>
        </div>
    </div>
</div>
</div>

<!--产品列表内容-->
<div class="product_nei">
    <div class="product_title"><h4>{$product.name}</h4><b>￥{$product.price}</b></div>
    <div class="count" data-count="{$cartCount}" data-store="{$product.store}" data-id="{$product.id}"><span class="count_ji">-</span><i></i><span class="count_jia">+</span>
    </div>
</div>
<div class="product_text">
    {$productContent.content}
</div>
<!--购物车-->
<div id="shop">
    <div class="shop">
        <div class="total">￥<span>267.00</span>
            <p>共<b>3</b>件商品</p></div>
        <div class="shop_na"><b></b></div>
        <a href="product_sub.html">选好了！</a>
    </div>
</div>
<!--购物车商品列表-->
<div id="shop_list">
    <div class="shop_list">
        <div class="shop_title"><span>购物车</span><img src="/static/images/cqlj.png" width="45"/></div>
        <ul>
            <li>
                <dt><img src="images/sou_07.jpg"/></dt>
                <div class="shop_nei"><h4>中国最美手工私游地</h4>
                    <p>￥89.00</p></div>
                <div class="count"><span class="count_ji">-</span><i>3</i><span class="count_jia">+</span></div>
            </li>
        </ul>
    </div>
</div>
<script src="/static/js/jquery-1.11.3.min.js" type="text/javascript"></script>
<script src="/static/js/global.js" type="text/javascript"></script>
<script src="/static/js/swiper.min.js" type="text/javascript"></script>
<script type="text/javascript" src="/static/js/jquery.nicescroll.js"></script>
<script type="text/javascript">
    $('.shop_list ul').niceScroll({
        cursorcolor: "#ccc",//#CC0071 光标颜色
        cursoropacitymax: 1, //改变不透明度非常光标处于活动状态（scrollabar“可见”状态），范围从1到0
        touchbehavior: false, //使光标拖动滚动像在台式电脑触摸设备
        cursorwidth: "0px", //像素光标的宽度
        cursorborder: "0", // 	游标边框css定义
        cursorborderradius: "5px",//以像素为光标边界半径
        autohidemode: false, //是否隐藏滚动条
    });
    var gao = $(".partner ul li").height();
    if (gao != 0) {
        $(".partner").height(gao);
        $(".partner_nei").height(gao);
    }
    var Swiper1 = $('.partner_nei').swiper({
        loop: true,
        slidesPerView: 1,
        autoplay: 3000,//自动播放
        speed: 800,//切换速度
        pagination: '.live_partner',//轮播分页
        autoplayDisableOnInteraction: false
    });

    //添加操作
    $(".count_jia").click(function () {
        var countObj = $(this).parent('.count');
        var count = countObj.data('count');
        countObj.find(".count_ji").show();
        if (parseInt(count) + 1 > countObj.data('store')){
            countObj.find("i").html(countObj.data('store'));
            return false;
        }
        // 请求服务
        $.ajax({
            type: 'post',
            url: "/product/addcart",
            data: {'id': countObj.data('id'),'num':parseInt(count) + 1},
            dataType: "json",
            success: function (data) {
                if (data.code === 0) {
                    countObj.find("i").html(parseInt(count) + 1);
                    countObj.data('count', parseInt(count) + 1);
                }
            },
            error:function (res) {
                alert('服务器开小差了');
            }
        });
    });
    //减操作
    $(".count_ji").click(function () {
        var countObj = $(this).parent('.count');
        var count = countObj.data('count');

        // 请求服务
        $.ajax({
            type: 'post',
            url: "/product/addcart",
            data: {'id': countObj.data('id'),'num':parseInt(count) - 1},
            dataType: "json",
            success: function (data) {
                if (data.code === 0) {
                    if (count <= 1) {
                        countObj.find(".count_ji").hide();
                        countObj.find("i").html("");
                        count = 1;
                    }else{
                        countObj.find("i").html(parseInt(count) - 1);
                        countObj.data('count', parseInt(count) - 1);
                    }
                }
            },
            error:function (res) {
                alert('服务器开小差了');
            }
        });
    });
    //显示购物列表
    $(".shop_na").click(function () {
        $("#shop_list").toggle();
    });
</script>
</body>
</html>