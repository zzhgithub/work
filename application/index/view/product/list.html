<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta content="width=device-width,user-scalable=no,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"
          name="viewport"/>
    <title>title</title>
    <link href="/static/css/style.css" type="text/css" rel="stylesheet"/>
</head>
<body class="light">
{include file="public/header" /}
<!--产品列表-->
<div class="product">
    <ul>
        {volist name="list" id="product"}
        <li><a href="/product/detail/{$product.id}"><img src="{$product.img}" width="100%"/><h5>{$product.name}</h5></a>
            <b>￥{$product.price}</b>
            <div class="count" data-store="{$product.store}">
                <span class="count_ji" onclick="reduceCount(this)">-</span><i></i><span class="count_jia" onclick="addCount(this)">+</span>
            </div>
        </li>
        {/volist}
    </ul>
</div>
<!--购物车-->
<div id="shop">
    <div class="shop">
        <div class="total">￥<span>267.00</span>
            <p>共<b>3</b>件商品</p></div>
        <div class="shop_na"><b></b></div>
        <a href="product_sub.html">选好了！</a>
    </div>
</div>
<!--购物车商品列表-->
<div id="shop_list">
    <div class="shop_list">
        <div class="shop_title"><span>购物车</span><img src="/static/images/cqlj.png" width="45"/></div>
        <ul>
            <li>
                <dt><img src="images/sou_07.jpg"/></dt>
                <div class="shop_nei"><h4>中国最美手工私游地</h4>
                    <p>￥89.00</p></div>
                <div class="count"><span class="count_ji">-</span><i>3</i><span class="count_jia">+</span></div>
            </li>
        </ul>
    </div>
</div>
<script src="/static/js/jquery-1.11.3.min.js" type="text/javascript"></script>
<script src="/static/js/global.js" type="text/javascript"></script>
<script type="text/javascript" src="/static/js/jquery.nicescroll.js"></script>
<script type="text/javascript">
    //添加操作
    function addCount(obj) {
        var zhi = $(obj).parent().parent("").find(".count i").html();
        $(obj).parent().parent("").find(".count_ji").show();
        if (zhi == "") {
            var zhi = 0;
        }
        var count = parseInt(zhi) + 1;
        if (count >= $(obj).parents('.count').data('store')){
            count = $(obj).parents('.count').data('store');
        }
        $(obj).parent().parent("").find(".count i").html(count);
    }
    //减操作
    function reduceCount(obj) {
        var zhi = $(obj).parent().parent("").find(".count i").html();
        if (zhi <= 1) {
            $(obj).parent().parent("").find(".count_ji").hide();
            $(obj).parent().parent("").find(".count i").html("");
        } else {
            $(obj).parent().parent("").find(".count i").html(parseInt(zhi) - 1);
        }
    }

    var flag = true;
    var currentPage = parseInt({$curPage});
    $(document).ready(function () {
        $('.shop_list ul').niceScroll({
            cursorcolor: "#ccc",//#CC0071 光标颜色
            cursoropacitymax: 1, //改变不透明度非常光标处于活动状态（scrollabar“可见”状态），范围从1到0
            touchbehavior: false, //使光标拖动滚动像在台式电脑触摸设备
            cursorwidth: "0px", //像素光标的宽度
            cursorborder: "0", // 	游标边框css定义
            cursorborderradius: "5px",//以像素为光标边界半径
            autohidemode: false, //是否隐藏滚动条
        });
        //显示购物列表
        $(".shop_na").click(function () {
            $("#shop_list").toggle();
        });
        $(window).scroll(function () {
            if ($(document).scrollTop() >= $(document).height() - $(window).height()) {
                if (!flag){
                    return false;
                }
                $.ajax({
                    type: 'post',
                    url: "/product/list",
                    data: {'page': currentPage - (-1)},
                    dataType: "json",
                    success: function (data) {
                        if (data.code === 0){
                            currentPage++;
                            var str = '';
                            for (var i = 0; i < data.data.length; i++) {
                                str += '<li><a href="/product/detail/'+data.data[i].id+'"><img src="'+data.data[i].img+'" width="100%"/><h5>'+data.data[i].name+'</h5></a><b>￥'+data.data[i].price+'</b><div class="count" data-store="'+data.data[i].store+'"><span class="count_ji" onclick="reduceCount(this)">-</span><i></i><span class="count_jia" onclick="addCount(this)">+</span></div></li>';
                            }
                            $('.product').find('ul').append(str);
                        }else{
                            flag = false;
                        }
                    },
                    error:function (res) {
                        alert('服务器开小差了');
                    }
                });
            }
        });
    });
</script>
</body>
</html>